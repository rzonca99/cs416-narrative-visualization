<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting Demographic Data 2000-2020</title>
    <link rel="stylesheet" href="styles.css">
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
</head>

<style>
    .bar { 
        fill: steelblue; 
    }
    .counties {
        fill: none;
    }
    .states {
        fill: none;
        stroke: #fff;
        stroke-linejoin: round;
    } 
</style>

<body>
        <div id="header">
            <h1>Voter Demographics, 2004 General Election</h1>
            <p>Welcome! This visualization shows demographic data for US presidential elections in the 21st century.<br>
            The map on the left shows the percent of people in each state who voted in this election. A darker color means more people voted.<br>
            The bar graph on the right shows the percent of people of each race who voted in this election.<br>
            By default, the bar graph shows data for the whole US.
            Select a state from the drop-down menu to see that state's election demographic data.<br>
            Or click the buttons to see the data for other presidential elections!</p>
            <button id="button2000_prev" class="submit-button">2000 Election</button>
            <button id="button2008_next" class="submit-button">2008 Election</button>
            <script type="text/javascript">
                document.getElementById("button2000_prev").onclick = function () {
                    location.href = "/cs416-narrative-visualization/index.html";
                };
                document.getElementById("button2008_next").onclick = function () {
                location.href = "/cs416-narrative-visualization/index3.html";
                };
            </script>
            </div>

    
    <div id="usbarchart"></div>
    <svg width=300 height=300></svg>
    <script>
        var margin = {top: 50, right: 50, bottom: 50, left: 50};

        var width = 600 - margin.left - margin.right;
        var height = 600 - margin.top - margin.bottom;

        var svg = d3.select("#usbarchart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.append("text")
            .attr("x", width / 2)
            .attr("y", 0.4)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text("Percent Voted by Race, 2004 General Election");

        svg.append("text")
            .attr("transform", "translate(" + (width / 2) + " ," + (height + 30) + ")")
            .style("text-anchor", "middle")
            .text("Race");

        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("x", -(height / 2))
            .attr("y", -30)
            .style("text-anchor", "middle")
            .text("Percentage");

        var x = d3.scaleBand()
            .range([0, width]).padding(0.4);

        var y = d3.scaleLinear()
            .range([height, 0]);

        d3.csv("electiondemographicdata.csv").then(function(data) {

            var tooltip = d3.select("body")
                .append("div")
                .style("position", "absolute")
                .style("z-index", "10")
                .style("visibility", "hidden")

            x.domain(data.map(function(d) { if (d.State == "US") { return d.Race; } }));
            y.domain([0, 100]);

            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", function (d) { return x(d.Race); })
                .attr("width", x.bandwidth)
                .attr("y", function (d) { return y(d.PercentVoted2004); })
                .attr("height", function (d) { return height - y(d.PercentVoted2004); })
                .on("mouseover", function(e,d) { 
                    return tooltip.style("visibility", "visible")
                                  .text(d.Race + ": " + d.PercentVoted2004 + "%");})
	            .on("mousemove", function(e,d) { 
                    return tooltip.style("top", (event.pageY-10)+"px")
                                  .style("left",(event.pageX+10)+"px")
                                  .text(d.Race + ": " + d.PercentVoted2004 + "%");})
	            .on("mouseleave", function() { 
                    return tooltip.style("visibility", "hidden");});

            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            svg.append("g")
                .call(d3.axisLeft(y));
        });

        var format = function(d) {
            d = d / 1000000;
            return d3.format(',.02f')(d) + 'M';
        }

    </script>

</body>
</html>
