<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting Demographic Data 2000-2020</title>
    <link rel="stylesheet" href="styles.css">
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
</head>

<style>
    .bar { 
        fill: steelblue; 
    }
    .counties {
        fill: none;
    }
    .states {
        fill: none;
        stroke: #fff;
        stroke-linejoin: round;
    } 
</style>

<body>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting Demographic Data 2000-2020</title>
    <link rel="stylesheet" href="styles.css">
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
</head>

<style>
    .bar { 
        fill: steelblue; 
    }
    .counties {
        fill: none;
    }
    .states {
        fill: none;
        stroke: #fff;
        stroke-linejoin: round;
    } 
</style>

<body>
    <div id="header">
        <h1>Voter Demographics, 2012 General Election</h1>
        <p>Welcome! This visualization shows demographic data for US presidential elections in the 21st century.<br>
        The map on the left shows the percent of people in each state who voted in this election. A darker color means more people voted.<br>
        The bar graph on the right shows the percent of people of each race who voted in this election.<br>
        By default, the bar graph shows data for the whole US.
        Select a state from the drop-down menu to see that state's election demographic data.<br>
        Or click the buttons to see the data for other presidential elections!</p>
        <button id="button2008_prev" class="submit-button">2008 Election</button>
        <button id="button2016_next" class="submit-button">2016 Election</button>
        <script type="text/javascript">
            document.getElementById("button2008_prev").onclick = function () {
                location.href = "/cs416-narrative-visualization/index.html";
            };
            document.getElementById("button2016_next").onclick = function () {
            location.href = "/cs416-narrative-visualization/index3.html";
            };
        </script>
        </div>

    <div id="usbarchart"></div>
    <svg width=300 height=300></svg>
    <script>
        var margin = {top: 50, right: 50, bottom: 50, left: 50};

        var width = 600 - margin.left - margin.right;
        var height = 600 - margin.top - margin.bottom;

        var svg = d3.select("#usbarchart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                svg.append("text")
            .attr("x", width / 2)
            .attr("y", 0.4)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text("Percent Voted by Race, 2008 General Election");

        svg.append("text")
            .attr("transform", "translate(" + (width / 2) + " ," + (height + 30) + ")")
            .style("text-anchor", "middle")
            .text("Race");

        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("x", -(height / 2))
            .attr("y", -30)
            .style("text-anchor", "middle")
            .text("Percentage");

        var x = d3.scaleBand()
            .range([0, width]).padding(0.4);

        var y = d3.scaleLinear()
            .range([height, 0]);

        d3.csv("electiondemographicdata.csv").then(function(data) {

            x.domain(data.map(function(d) { if (d.State == "US") { return d.Race; } }));
            y.domain([0, 100]);

            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", function (d) { return x(d.Race); })
                .attr("width", x.bandwidth)
                .attr("y", function (d) { return y(d.PercentVoted2008); })
                .attr("height", function (d) { return height - y(d.PercentVoted2008); });

            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            svg.append("g")
                .call(d3.axisLeft(y));
        });

        var format = function(d) {
            d = d / 1000000;
            return d3.format(',.02f')(d) + 'M';
        }

    </script>

    <!-- <div id="choropleth"></div>
    <svg width="480" height="300"></svg>
    <script>
        var svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        var unemployment = d3.map();

        var path = d3.geoPath();

        var x = d3.scaleLinear()
            .domain([1, 10])
            .rangeRound([600, 860]);

        var color = d3.scaleThreshold()
            .domain(d3.range(2, 10))
            .range(d3.schemeBlues[9]);

        var g = svg.append("g")
            .attr("class", "key")
            .attr("transform", "translate(0,40)");

        g.selectAll("rect")
        .data(color.range().map(function(d) {
            d = color.invertExtent(d);
            if (d[0] == null) d[0] = x.domain()[0];
            if (d[1] == null) d[1] = x.domain()[1];
            return d;
            }))
        .enter().append("rect")
            .attr("height", 8)
            .attr("x", function(d) { return x(d[0]); })
            .attr("width", function(d) { return x(d[1]) - x(d[0]); })
            .attr("fill", function(d) { return color(d[0]); });

        g.append("text")
            .attr("class", "caption")
            .attr("x", x.range()[0])
            .attr("y", -6)
            .attr("fill", "#000")
            .attr("text-anchor", "start")
            .attr("font-weight", "bold")
            .text("Unemployment rate");

        g.call(d3.axisBottom(x)
            .tickSize(13)
            .tickFormat(function(x, i) { return i ? x : x + "%"; })
            .tickValues(color.domain()))
        .select(".domain")
            .remove();

        const files = ["https://d3js.org/us-10m.v1.json", "unemployment.tsv"];
        const rateById = new Map();

        function row(d) {
            rateById.set(d.id, +d.rate);
        };

        const promises = [];
        files.forEach(function(url, index) {
            promises.push(index ? d3.tsv(url, row) : d3.json(url))
        });

        Promise.all(promises).then(function(data) {
            console.log(data); //check if all data was loaded
            //any code that depends on 'data' goes here
        });

        function ready(error, us) {
        if (error) throw error;

        svg.append("g")
            .attr("class", "counties")
            .selectAll("path")
            .data(topojson.feature(us, us.objects.counties).features)
            .enter().append("path")
            .attr("fill", function(d) { return color(d.rate = unemployment.get(d.id)); })
            .attr("d", path)
            .append("title")
            .text(function(d) { return d.rate + "%"; });

        svg.append("path")
            .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
            .attr("class", "states")
            .attr("d", path);
        }
    </script> -->

</body>
</html>
    <div id="usbarchart"></div>
    <svg width=300 height=300></svg>
    <script>
        var margin = {top: 50, right: 50, bottom: 50, left: 50};

        var width = 600 - margin.left - margin.right;
        var height = 600 - margin.top - margin.bottom;

        var svg = d3.select("#usbarchart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                svg.append("text")
            .attr("x", width / 2)
            .attr("y", 0.4)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text("Percent Voted by Race, 2012 General Election");

        svg.append("text")
            .attr("transform", "translate(" + (width / 2) + " ," + (height + 30) + ")")
            .style("text-anchor", "middle")
            .text("Race");

        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("x", -(height / 2))
            .attr("y", -30)
            .style("text-anchor", "middle")
            .text("Percentage");

        var x = d3.scaleBand()
            .range([0, width]).padding(0.4);

        var y = d3.scaleLinear()
            .range([height, 0]);

        d3.csv("electiondemographicdata.csv").then(function(data) {

            x.domain(data.map(function(d) { if (d.State == "US") { return d.Race; } }));
            y.domain([0, 100]);

            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", function (d) { return x(d.Race); })
                .attr("width", x.bandwidth)
                .attr("y", function (d) { return y(d.PercentVoted2012); })
                .attr("height", function (d) { return height - y(d.PercentVoted2012); });

            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            svg.append("g")
                .call(d3.axisLeft(y));
        });

        var format = function(d) {
            d = d / 1000000;
            return d3.format(',.02f')(d) + 'M';
        }

    </script>

    <!-- <div id="choropleth"></div>
    <svg width="480" height="300"></svg>
    <script>
        var svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        var unemployment = d3.map();

        var path = d3.geoPath();

        var x = d3.scaleLinear()
            .domain([1, 10])
            .rangeRound([600, 860]);

        var color = d3.scaleThreshold()
            .domain(d3.range(2, 10))
            .range(d3.schemeBlues[9]);

        var g = svg.append("g")
            .attr("class", "key")
            .attr("transform", "translate(0,40)");

        g.selectAll("rect")
        .data(color.range().map(function(d) {
            d = color.invertExtent(d);
            if (d[0] == null) d[0] = x.domain()[0];
            if (d[1] == null) d[1] = x.domain()[1];
            return d;
            }))
        .enter().append("rect")
            .attr("height", 8)
            .attr("x", function(d) { return x(d[0]); })
            .attr("width", function(d) { return x(d[1]) - x(d[0]); })
            .attr("fill", function(d) { return color(d[0]); });

        g.append("text")
            .attr("class", "caption")
            .attr("x", x.range()[0])
            .attr("y", -6)
            .attr("fill", "#000")
            .attr("text-anchor", "start")
            .attr("font-weight", "bold")
            .text("Unemployment rate");

        g.call(d3.axisBottom(x)
            .tickSize(13)
            .tickFormat(function(x, i) { return i ? x : x + "%"; })
            .tickValues(color.domain()))
        .select(".domain")
            .remove();

        const files = ["https://d3js.org/us-10m.v1.json", "unemployment.tsv"];
        const rateById = new Map();

        function row(d) {
            rateById.set(d.id, +d.rate);
        };

        const promises = [];
        files.forEach(function(url, index) {
            promises.push(index ? d3.tsv(url, row) : d3.json(url))
        });

        Promise.all(promises).then(function(data) {
            console.log(data); //check if all data was loaded
            //any code that depends on 'data' goes here
        });

        function ready(error, us) {
        if (error) throw error;

        svg.append("g")
            .attr("class", "counties")
            .selectAll("path")
            .data(topojson.feature(us, us.objects.counties).features)
            .enter().append("path")
            .attr("fill", function(d) { return color(d.rate = unemployment.get(d.id)); })
            .attr("d", path)
            .append("title")
            .text(function(d) { return d.rate + "%"; });

        svg.append("path")
            .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
            .attr("class", "states")
            .attr("d", path);
        }
    </script> -->

</body>
</html>
