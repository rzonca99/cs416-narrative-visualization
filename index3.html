<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting Demographic Data 2000-2020</title>
    <link rel="stylesheet" href="styles.css">
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
</head>

<style>
    .bar { 
        fill: steelblue; 
    }
    .counties {
        fill: none;
    }
    .states {
        fill: none;
        stroke: #fff;
        stroke-linejoin: round;
    } 
</style>

<body>
    <div id="graphs">
        <div id="choropleth">
        <svg id="choropleth_svg" width="765" height="525" preserveAspectRatio="xMinYMid meet"></svg>
        <script>
    
            // The svg
            const svg = d3.select("svg"),
              width = +svg.attr("width"),
              height = +svg.attr("height");
            
            // Map and projection
            const path = d3.geoPath();
            const projection = d3.geoMercator()
              .scale(750)
              .center([-95,35])
              .translate([width / 2, height / 2]);
            
            // Data and color scale
            let data = new Map()
            const colorScale = d3.scaleThreshold()
              .domain([20, 40, 50, 60, 70, 80])
              .range(d3.schemeBlues[7]);
            
            // Load external data and boot
            Promise.all([
            d3.json("states.json"),
            d3.csv("electiondemographicdata.csv", function(d) {
                if (d.Race == "Total" && d.State != "US") {
                    data.set(d.State, +d.PercentVoted2008)
                }
            })
            ]).then(function(loadData){
                let topo = loadData[0]
    
              // Draw the map
              svg.append("g")
                .selectAll("path")
                .data(topo.features)
                .join("path")
                  // draw each country
                  .attr("d", d3.geoPath()
                    .projection(projection)
                  )
                  // set the color of each country
                  .attr("fill", function (d) {
                    d.total = data.get(d.properties.NAME); //|| 0;
                    return colorScale(d.total);
                  })
            })
            
            </script>
        </div>
    
        <div id="usbarchart">
        <svg id="usbarchart_svg" width=600 height=550 preserveAspectRatio="xMaxYMid meet"></svg>
        <select id="dropdown">
            <option value="Select a State">Select</option>
            <option value="Alabama">Alabama</option>
            <option value="Alaska">Alaska</option>
            <option value="Arizona">Arizona</option>
            <option value="Arkansas">Arkansas</option>
            <option value="California">California</option>
            <option value="Colorado">Colorado</option>
            <option value="Connecticut">Connecticut</option>
            <option value="Delaware">Delaware</option>
            <option value="Florida">Florida</option>
            <option value="Georgia">Georgia</option>
            <option value="Hawaii">Hawaii</option>
            <option value="Idaho">Idaho</option>
            <option value="Illinois">Illinois</option>
            <option value="Indiana">Indiana</option>
            <option value="Iowa">Iowa</option>
            <option value="Kansas">Kansas</option>
            <option value="Kentucky">Kentucky</option>
            <option value="Louisiana">Louisiana</option>
            <option value="Maine">Maine</option>
            <option value="Maryland">Maryland</option>
            <option value="Massachusetts">Massachusetts</option>
            <option value="Michigan">Michigan</option>
            <option value="Minnesota">Minnesota</option>
            <option value="Mississippi">Mississippi</option>
            <option value="Missouri">Missouri</option>
            <option value="Montana">Montana</option>
            <option value="Nebraska">Nebraska</option>
            <option value="Nevada">Nevada</option>
            <option value="New Hampshire">New Hampshire</option>
            <option value="New Jersey">New Jersey</option>
            <option value="New Mexico">New Mexico</option>
            <option value="New York">New York</option>
            <option value="North Carolina">North Carolina</option>
            <option value="North Dakota">North Dakota</option>
            <option value="Ohio">Ohio</option>
            <option value="Oklahoma">Oklahoma</option>
            <option value="Oregon">Oregon</option>
            <option value="Pennsylvania">Pennsylvania</option>
            <option value="Rhode Island">Rhode Island</option>
            <option value="South Carolina">South Carolina</option>
            <option value="South Dakota">South Dakota</option>
            <option value="Tennessee">Tennessee</option>
            <option value="Texas">Texas</option>
            <option value="Utah">Utah</option>
            <option value="Vermont">Vermont</option>
            <option value="Virginia">Virginia</option>
            <option value="Washington">Washington</option>
            <option value="West Virginia">West Virginia</option>
            <option value="Wisconsin">Wisconsin</option>
            <option value="Wyoming">Wyoming</option>
        </select>
        <script>
    
            var margin = {top: 50, right: 50, bottom: 50, left: 50};
    
            var width2 = 600 - margin.left - margin.right;
            var height2 = 550 - margin.top - margin.bottom;
    
            var svg2 = d3.select("#usbarchart_svg").append("svg")
                // width2 = +svg.attr("width"),
                // height2 = +svg.attr("height");
                .attr("width", width2 + margin.left + margin.right)
                .attr("height", height2 + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
            var g = svg2.append("g")
                .attr("transform", "translate(" + 100 + "," + 100 + ")");
    
            // Add labels
            svg2.append("text")
                .attr("x", (width2 / 2))
                .attr("y", 0.4)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .text("Percent Voted by Race, 2000 General Election");
    
            svg2.append("text")
                .attr("transform", "translate(" + (width2 / 2) + " ," + (height2 + 30) + ")")
                .style("text-anchor", "middle")
                .text("Race");
    
            svg2.append("text")
                .attr("transform", "rotate(-90)")
                .attr("x", -(height2 / 2))
                .attr("y", -30)
                .style("text-anchor", "middle")
                .text("Percentage");
    
            var x = d3.scaleBand()
                .range([0, width2]).padding(0.4);
    
            var y = d3.scaleLinear()
                .range([height2, 0]);
    
            d3.csv("electiondemographicdata.csv").then(function(data) {
    
                // Create dropdown menu
                function mydropDown(data) {
                    var states = [];
                    for (var i in data) {
                        states.push(data[i].key);
                    };
    
                var dropDown = d3.select("#dropdown")
                    .append("select")
                    .attr("class", "selection")
                    .attr("name", "dropdown");
    
                var options = dropDown.selectAll("option")
                    .data(data)
                    .enter()
                    .append("option");
                    
                options.text(function(d) { return d.key; })
                    .attr("value", function(d) { return d.values;});
                }
    
                // Set domains
                x.domain(data.map(function(d) { if (d.State == "US") { return d.Race; } }));
                y.domain([0, 100]);
    
                // Declare tooltips
                var tooltip = d3.select("body")
                    .append("div")
                    .style("position", "absolute")
                    .style("z-index", "10")
                    .style("visibility", "hidden")
    
                // Create axes
                svg2.append("g")
                    .attr("transform", "translate(0," + height2 + ")")
                    .call(d3.axisBottom(x));
    
                svg2.append("g")
                    .call(d3.axisLeft(y));
    
                // Create graph
                svg2.selectAll(".bar")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", function (d) { 
                        return x(d.Race); })
                    .attr("y", function (d) { 
                        return y(d.PercentVoted2008); })
                    .attr("width", x.bandwidth)
                    .attr("height", function (d) { 
                        return height2 - y(d.PercentVoted2008); })
                    .on("mouseover", function(e,d) { 
                        return tooltip.style("visibility", "visible")
                                      .text(d.Race + ": " + d.PercentVoted2008 + "%");})
                    .on("mousemove", function(e,d) { 
                        return tooltip.style("top", (event.pageY-10)+"px")
                                      .style("left",(event.pageX+10)+"px")
                                      .text(d.Race + ": " + d.PercentVoted2008 + "%");})
                    .on("mouseleave", function() { 
                        return tooltip.style("visibility", "hidden");});
    
            });
    
            var format = function(d) {
                d = d / 1000000;
                return d3.format(',.02f')(d) + 'M';
            }
    
        </script>
        </div>
        </div>

</body>
</html>
